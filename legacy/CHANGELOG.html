<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style>body {
  max-width: 980px;
  border: 1px solid #ddd;
  outline: 1300px solid #fff;
  margin: 16px auto;
}

body .markdown-body
{
  padding: 45px;
}

@font-face {
  font-family: fontawesome-mini;
  src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}

.markdown-body {
  font-family: sans-serif;
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  color: #333333;
  overflow: hidden;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
}

.markdown-body a {
  background: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body b,
.markdown-body strong {
  font-weight: bold;
}

.markdown-body mark {
  background: #ff0;
  color: #000;
  font-style: italic;
  font-weight: bold;
}

.markdown-body sub,
.markdown-body sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
.markdown-body sup {
  top: -0.5em;
}
.markdown-body sub {
  bottom: -0.25em;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre,
.markdown-body samp {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body .codehilitetable {
  border: 0;
  border-spacing: 0;
}

.markdown-body .codehilitetable tr {
  border: 0;
}

.markdown-body .codehilitetable pre,
.markdown-body .codehilitetable div.codehilite {
  margin: 0;
}

.markdown-body .linenos,
.markdown-body .code,
.markdown-body .codehilitetable td {
  border: 0;
  padding: 0;
}

.markdown-body td:not(.linenos) .linenodiv {
  padding: 0 !important;
}

.markdown-body .code {
  width: 100%;
}

.markdown-body .linenos div pre,
.markdown-body .linenodiv pre,
.markdown-body .linenodiv {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-left-radius: 3px;
  -webkit-border-bottom-left-radius: 3px;
  -moz-border-radius-topleft: 3px;
  -moz-border-radius-bottomleft: 3px;
  border-top-left-radius: 3px;
  border-bottom-left-radius: 3px;
}

.markdown-body .code div pre,
.markdown-body .code div {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-right-radius: 3px;
  -webkit-border-bottom-right-radius: 3px;
  -moz-border-radius-topright: 3px;
  -moz-border-radius-bottomright: 3px;
  border-top-right-radius: 3px;
  border-bottom-right-radius: 3px;
}

.markdown-body * {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body input {
  font: 13px Helvetica, arial, freesans, clean, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
  line-height: 1.4;
}

.markdown-body a {
  color: #4183c4;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:focus,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before,
.markdown-body hr:after {
  display: table;
  content: " ";
}

.markdown-body hr:after {
  clear: both;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code,
.markdown-body pre,
.markdown-body samp {
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  font-size: 12px;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body kbd {
  background-color: #e7e7e7;
  background-image: -moz-linear-gradient(#fefefe, #e7e7e7);
  background-image: -webkit-linear-gradient(#fefefe, #e7e7e7);
  background-image: linear-gradient(#fefefe, #e7e7e7);
  background-repeat: repeat-x;
  border-radius: 2px;
  border: 1px solid #cfcfcf;
  color: #000;
  padding: 3px 5px;
  line-height: 10px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  display: inline-block;
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body .headerlink {
  font: normal 400 16px fontawesome-mini;
  vertical-align: middle;
  margin-left: -16px;
  float: left;
  display: inline-block;
  text-decoration: none;
  opacity: 0;
  color: #333;
}

.markdown-body .headerlink:focus {
  outline: none;
}

.markdown-body h1 .headerlink {
  margin-top: 0.8rem;
}

.markdown-body h2 .headerlink,
.markdown-body h3 .headerlink {
  margin-top: 0.6rem;
}

.markdown-body h4 .headerlink {
  margin-top: 0.2rem;
}

.markdown-body h5 .headerlink,
.markdown-body h6 .headerlink {
  margin-top: 0;
}

.markdown-body .headerlink:hover,
.markdown-body h1:hover .headerlink,
.markdown-body h2:hover .headerlink,
.markdown-body h3:hover .headerlink,
.markdown-body h4:hover .headerlink,
.markdown-body h5:hover .headerlink,
.markdown-body h6:hover .headerlink {
  opacity: 1;
  text-decoration: none;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre,
.markdown-body .admonition {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body code,
.markdown-body samp {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0,0,0,0.04);
  border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .codehilite {
  margin-bottom: 16px;
}

.markdown-body .codehilite pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}

.markdown-body .codehilite pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

/* Admonition */
.markdown-body .admonition {
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  position: relative;
  border-radius: 3px;
  border: 1px solid #e0e0e0;
  border-left: 6px solid #333;
  padding: 10px 10px 10px 30px;
}

.markdown-body .admonition table {
  color: #333;
}

.markdown-body .admonition p {
  padding: 0;
}

.markdown-body .admonition-title {
  font-weight: bold;
  margin: 0;
}

.markdown-body .admonition>.admonition-title {
  color: #333;
}

.markdown-body .attention>.admonition-title {
  color: #a6d796;
}

.markdown-body .caution>.admonition-title {
  color: #d7a796;
}

.markdown-body .hint>.admonition-title {
  color: #96c6d7;
}

.markdown-body .danger>.admonition-title {
  color: #c25f77;
}

.markdown-body .question>.admonition-title {
  color: #96a6d7;
}

.markdown-body .note>.admonition-title {
  color: #d7c896;
}

.markdown-body .admonition:before,
.markdown-body .attention:before,
.markdown-body .caution:before,
.markdown-body .hint:before,
.markdown-body .danger:before,
.markdown-body .question:before,
.markdown-body .note:before {
  font: normal normal 16px fontawesome-mini;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  line-height: 1.5;
  color: #333;
  position: absolute;
  left: 0;
  top: 0;
  padding-top: 10px;
  padding-left: 10px;
}

.markdown-body .admonition:before {
  content: "\f056\00a0";
  color: 333;
}

.markdown-body .attention:before {
  content: "\f058\00a0";
  color: #a6d796;
}

.markdown-body .caution:before {
  content: "\f06a\00a0";
  color: #d7a796;
}

.markdown-body .hint:before {
  content: "\f05a\00a0";
  color: #96c6d7;
}

.markdown-body .danger:before {
  content: "\f057\00a0";
  color: #c25f77;
}

.markdown-body .question:before {
  content: "\f059\00a0";
  color: #96a6d7;
}

.markdown-body .note:before {
  content: "\f040\00a0";
  color: #d7c896;
}

.markdown-body .admonition::after {
  content: normal;
}

.markdown-body .attention {
  border-left: 6px solid #a6d796;
}

.markdown-body .caution {
  border-left: 6px solid #d7a796;
}

.markdown-body .hint {
  border-left: 6px solid #96c6d7;
}

.markdown-body .danger {
  border-left: 6px solid #c25f77;
}

.markdown-body .question {
  border-left: 6px solid #96a6d7;
}

.markdown-body .note {
  border-left: 6px solid #d7c896;
}

.markdown-body .admonition>*:first-child {
  margin-top: 0 !important;
}

.markdown-body .admonition>*:last-child {
  margin-bottom: 0 !important;
}

/* progress bar*/
.markdown-body .progress {
  display: block;
  width: 300px;
  margin: 10px 0;
  height: 24px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #ededed;
  position: relative;
  box-shadow: inset -1px 1px 3px rgba(0, 0, 0, .1);
}

.markdown-body .progress-label {
  position: absolute;
  text-align: center;
  font-weight: bold;
  width: 100%; margin: 0;
  line-height: 24px;
  color: #333;
  text-shadow: 1px 1px 0 #fefefe, -1px -1px 0 #fefefe, -1px 1px 0 #fefefe, 1px -1px 0 #fefefe, 0 1px 0 #fefefe, 0 -1px 0 #fefefe, 1px 0 0 #fefefe, -1px 0 0 #fefefe, 1px 1px 2px #000;
  -webkit-font-smoothing: antialiased !important;
  white-space: nowrap;
  overflow: hidden;
}

.markdown-body .progress-bar {
  height: 24px;
  float: left;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #96c6d7;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, .5), inset 0 -1px 0 rgba(0, 0, 0, .1);
  background-size: 30px 30px;
  background-image: -webkit-linear-gradient(
    135deg, rgba(255, 255, 255, .4) 27%,
    transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%,
    transparent 77%, transparent
  );
  background-image: -moz-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -ms-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -o-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
}

.markdown-body .progress-100plus .progress-bar {
  background-color: #a6d796;
}

.markdown-body .progress-80plus .progress-bar {
  background-color: #c6d796;
}

.markdown-body .progress-60plus .progress-bar {
  background-color: #d7c896;
}

.markdown-body .progress-40plus .progress-bar {
  background-color: #d7a796;
}

.markdown-body .progress-20plus .progress-bar {
  background-color: #d796a6;
}

.markdown-body .progress-0plus .progress-bar {
  background-color: #c25f77;
}

.markdown-body .candystripe-animate .progress-bar{
  -webkit-animation: animate-stripes 3s linear infinite;
  -moz-animation: animate-stripes 3s linear infinite;
  animation: animate-stripes 3s linear infinite;
}

@-webkit-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@-moz-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

.markdown-body .gloss .progress-bar {
  box-shadow:
    inset 0 4px 12px rgba(255, 255, 255, .7),
    inset 0 -12px 0 rgba(0, 0, 0, .05);
}

/* MultiMarkdown Critic Blocks */
.markdown-body .critic_mark {
  background: #ff0;
}

.markdown-body .critic_delete {
  color: #c82829;
  text-decoration: line-through;
}

.markdown-body .critic_insert {
  color: #718c00 ;
  text-decoration: underline;
}

.markdown-body .critic_comment {
  color: #8e908c;
  font-style: italic;
}

.markdown-body .headeranchor {
  font: normal normal 16px fontawesome-mini;
  line-height: 1;
  display: inline-block;
  text-decoration: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.headeranchor:before {
  content: '\e157';
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  margin: 0 4px 0.25em -20px;
  vertical-align: middle;
}

/* Media */
@media only screen and (min-width: 480px) {
  .markdown-body {
    font-size:14px;
  }
}

@media only screen and (min-width: 768px) {
  .markdown-body {
    font-size:16px;
  }
}

@media print {
  .markdown-body * {
    background: transparent !important;
    color: black !important;
    filter:none !important;
    -ms-filter: none !important;
  }

  .markdown-body {
    font-size:12pt;
    max-width:100%;
    outline:none;
    border: 0;
  }

  .markdown-body a,
  .markdown-body a:visited {
    text-decoration: underline;
  }

  .markdown-body .headeranchor-link {
    display: none;
  }

  .markdown-body a[href]:after {
    content: " (" attr(href) ")";
  }

  .markdown-body abbr[title]:after {
    content: " (" attr(title) ")";
  }

  .markdown-body .ir a:after,
  .markdown-body a[href^="javascript:"]:after,
  .markdown-body a[href^="#"]:after {
    content: "";
  }

  .markdown-body pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .markdown-body pre,
  .markdown-body blockquote {
    border: 1px solid #999;
    padding-right: 1em;
    page-break-inside: avoid;
  }

  .markdown-body .progress,
  .markdown-body .progress-bar {
    -moz-box-shadow: none;
    -webkit-box-shadow: none;
    box-shadow: none;
  }

  .markdown-body .progress {
    border: 1px solid #ddd;
  }

  .markdown-body .progress-bar {
    height: 22px;
    border-right: 1px solid #ddd;
  }

  .markdown-body tr,
  .markdown-body img {
    page-break-inside: avoid;
  }

  .markdown-body img {
    max-width: 100% !important;
  }

  .markdown-body p,
  .markdown-body h2,
  .markdown-body h3 {
    orphans: 3;
    widows: 3;
  }

  .markdown-body h2,
  .markdown-body h3 {
    page-break-after: avoid;
  }
}
</style><style>/*GitHub*/
.codehilite {background-color:#fff;color:#333333;}
.codehilite .hll {background-color:#ffffcc;}
.codehilite .c{color:#999988;font-style:italic}
.codehilite .err{color:#a61717;background-color:#e3d2d2}
.codehilite .k{font-weight:bold}
.codehilite .o{font-weight:bold}
.codehilite .cm{color:#999988;font-style:italic}
.codehilite .cp{color:#999999;font-weight:bold}
.codehilite .c1{color:#999988;font-style:italic}
.codehilite .cs{color:#999999;font-weight:bold;font-style:italic}
.codehilite .gd{color:#000000;background-color:#ffdddd}
.codehilite .ge{font-style:italic}
.codehilite .gr{color:#aa0000}
.codehilite .gh{color:#999999}
.codehilite .gi{color:#000000;background-color:#ddffdd}
.codehilite .go{color:#888888}
.codehilite .gp{color:#555555}
.codehilite .gs{font-weight:bold}
.codehilite .gu{color:#800080;font-weight:bold}
.codehilite .gt{color:#aa0000}
.codehilite .kc{font-weight:bold}
.codehilite .kd{font-weight:bold}
.codehilite .kn{font-weight:bold}
.codehilite .kp{font-weight:bold}
.codehilite .kr{font-weight:bold}
.codehilite .kt{color:#445588;font-weight:bold}
.codehilite .m{color:#009999}
.codehilite .s{color:#dd1144}
.codehilite .n{color:#333333}
.codehilite .na{color:teal}
.codehilite .nb{color:#0086b3}
.codehilite .nc{color:#445588;font-weight:bold}
.codehilite .no{color:teal}
.codehilite .ni{color:purple}
.codehilite .ne{color:#990000;font-weight:bold}
.codehilite .nf{color:#990000;font-weight:bold}
.codehilite .nn{color:#555555}
.codehilite .nt{color:navy}
.codehilite .nv{color:teal}
.codehilite .ow{font-weight:bold}
.codehilite .w{color:#bbbbbb}
.codehilite .mf{color:#009999}
.codehilite .mh{color:#009999}
.codehilite .mi{color:#009999}
.codehilite .mo{color:#009999}
.codehilite .sb{color:#dd1144}
.codehilite .sc{color:#dd1144}
.codehilite .sd{color:#dd1144}
.codehilite .s2{color:#dd1144}
.codehilite .se{color:#dd1144}
.codehilite .sh{color:#dd1144}
.codehilite .si{color:#dd1144}
.codehilite .sx{color:#dd1144}
.codehilite .sr{color:#009926}
.codehilite .s1{color:#dd1144}
.codehilite .ss{color:#990073}
.codehilite .bp{color:#999999}
.codehilite .vc{color:teal}
.codehilite .vg{color:teal}
.codehilite .vi{color:teal}
.codehilite .il{color:#009999}
.codehilite .gc{color:#999;background-color:#EAF2F5}
</style><title>CHANGELOG</title></head><body><article class="markdown-body"><h1 id="hacking-openhip-to-work-with-openssl-v11x">Hacking OpenHIP to work with OpenSSL v1.1.X<a class="headerlink" href="#hacking-openhip-to-work-with-openssl-v11x" title="Permanent link"></a></h1>
<p>DISCLAIMER: This does not produce a functioning HIP binary. Segfaults occur while attempting to run the &lsquo;hip&rsquo; binary. The &lsquo;hitgen&rsquo; binary functions just fine and creates all the necessary files.</p>
<p>This documented was created by Adam Wiethuechter and Jim Henrickson of Critical Technologies Inc. (CTI) during their struggles to get OpenHIP to work on Ubuntu 18.04 LTS which has OpenSSL 1.1.0g installed on it by default.</p>
<p>There is a patch folder (&lsquo;openhip-patch/&rsquo;) that has a script to automatically patch OpenHIP included for you to use/consult. To run it do the following:</p>
<div class="codehilite"><pre>cd /path/to/openhip-patch/
sudo chmod +x *.sh
./openhip-patch.sh /path/to/openhip/source/
</pre></div>

<p>The documentation that follows is cleaned up notes from the build process that we hope someone will find helpful.</p>
<h2 id="installing">Installing<a class="headerlink" href="#installing" title="Permanent link"></a></h2>
<div class="codehilite"><pre>sudo apt install pkg-config libxml2 libxml2-dev gcc g++ make automake autoconf binutils openssh-server openssl libssl-dev
sudo apt install zip unzip
</pre></div>

<p>We used the source of OpenHIP using the <a href="https://bitbucket.org/openhip/openhip/overview">branch named <em>hipv2</em></a> as of 2019-03-20. This specifically was commit &ldquo;7ca0bd5&rdquo;.</p>
<h2 id="building">Building<a class="headerlink" href="#building" title="Permanent link"></a></h2>
<div class="codehilite"><pre>unzip /path/to/openhip/source.zip
cd /path/to/openhip/source/
./bootstrap.sh
./configure
make
</pre></div>

<h2 id="fixing-errors">Fixing Errors<a class="headerlink" href="#fixing-errors" title="Permanent link"></a></h2>
<p>When fixing errors there is the resource of the &lsquo;diff&rsquo; directory.
This directory is structured holding all the files changed during the below errors and contain the following files:</p>
<ul>
<li>A original copy (*.orig) from the original OpenHIP base.</li>
<li>A new changed copy that was used to make a functional build.</li>
<li>A diff file (*.diff) that is a diff of the new and original files using the following command:</li>
</ul>
<div class="codehilite"><pre>diff &lt;changed-file&gt; &lt;original-file&gt; &gt; &lt;filename&gt;.diff
</pre></div>

<p>Envoked in this way the content in the diff file is as follows:</p>
<ul>
<li>The &ldquo;&lt;&rdquo; mark before a line indicates the line comes from the changed file</li>
<li>The &ldquo;&gt;&rdquo; mark before a line indicated the line comes from the original file</li>
</ul>
<p>This can be a valuable reference to see exactly what changed and on what lines.
The originals are also included to perform your own diffs/searches as desired for debugging.</p>
<p>All original make output errors in raw form are located in &lsquo;errors/&rsquo; numbered in order to when they were encountered.
The file uses the file name as a header to reference this original raw file.</p>
<h3 id="error-1">Error 1<a class="headerlink" href="#error-1" title="Permanent link"></a></h3>
<p><strong>FILE AFFECTED: src/util/hitgen.c</strong></p>
<div class="codehilite"><pre>util/hitgen.c: In function ‘generate_HI’:
util/hitgen.c:138:7: error: ‘DSA_generate_parameters’ is deprecated [-Werror=deprecated-declarations]
       dsa = DSA_generate_parameters(opts-&gt;bitsize, seed, sizeof(seed),
       ^~~
In file included from /usr/include/openssl/asn1.h:15:0,
                 from /usr/include/openssl/dh.h:18,
                 from /usr/include/openssl/dsa.h:31,
                 from util/hitgen.c:39:
/usr/include/openssl/dsa.h:122:1: note: declared here
 DEPRECATEDIN_0_9_8(DSA *DSA_generate_parameters(int bits,
 ^
util/hitgen.c:156:7: error: ‘RSA_generate_key’ is deprecated [-Werror=deprecated-declarations]
       rsa = RSA_generate_key(opts-&gt;bitsize, e, cb, stdout);
       ^~~
In file included from /usr/include/openssl/rsa.h:13:0,
                 from util/hitgen.c:40:
/usr/include/openssl/rsa.h:193:1: note: declared here
 DEPRECATEDIN_0_9_8(RSA *RSA_generate_key(int bits, unsigned long e, void
 ^
util/hitgen.c:212:65: error: dereferencing pointer to incomplete type ‘DSA {aka struct dsa_st}’
       xmlNewChild(hi, NULL, BAD_CAST &quot;P&quot;, BAD_CAST BN_bn2hex(dsa-&gt;p));
                                                                 ^~
util/hitgen.c:221:65: error: dereferencing pointer to incomplete type ‘RSA {aka struct rsa_st}’
       xmlNewChild(hi, NULL, BAD_CAST &quot;N&quot;, BAD_CAST BN_bn2hex(rsa-&gt;n));
                                                                 ^~
</pre></div>

<p>This error is pointing out that the functions used to generate the parameters for DSA and the generate key function for RSA have become deprecated in OpenSSL.
During this build we are running <strong>OpenSSL version 1.1.0g</strong>.</p>
<p>The way we fixed this is by digging into the OpenSSL source code found on GitHub <a href="https://github.com/openssl/openssl">here</a>.
Under the &lsquo;crypto&rsquo; directory there are two major files we looked into: &lsquo;dsa/dsa_depr.c&rsquo; and &lsquo;rsa/rsa_depr.c&rsquo;.</p>
<p>These files contained two functions that were of interest to us:</p>
<div class="codehilite"><pre>// FROM dsa_depr.c
DSA *DSA_generate_parameters(int bits,
                             unsigned char *seed_in, int seed_len,
                             int *counter_ret, unsigned long *h_ret,
                             void (*callback) (int, int, void *),
                             void *cb_arg)
{
    BN_GENCB *cb;
    DSA *ret;

    if ((ret = DSA_new()) == NULL)
        return NULL;
    cb = BN_GENCB_new();
    if (cb == NULL)
        goto err;

    BN_GENCB_set_old(cb, callback, cb_arg);

    if (DSA_generate_parameters_ex(ret, bits, seed_in, seed_len,
                                   counter_ret, h_ret, cb)) {
        BN_GENCB_free(cb);
        return ret;
    }
    BN_GENCB_free(cb);
err:
    DSA_free(ret);
    return NULL;
}

// FROM rsa_depr.c
RSA *RSA_generate_key(int bits, unsigned long e_value,
                      void (*callback) (int, int, void *), void *cb_arg)
{
    int i;
    BN_GENCB *cb = BN_GENCB_new();
    RSA *rsa = RSA_new();
    BIGNUM *e = BN_new();

    if (cb == NULL || rsa == NULL || e == NULL)
        goto err;

    /*
     * The problem is when building with 8, 16, or 32 BN_ULONG, unsigned long
     * can be larger
     */
    for (i = 0; i &lt; (int)sizeof(unsigned long) * 8; i++) {
        if (e_value &amp; (1UL &lt;&lt; i))
            if (BN_set_bit(e, i) == 0)
                goto err;
    }

    BN_GENCB_set_old(cb, callback, cb_arg);

    if (RSA_generate_key_ex(rsa, bits, e, cb)) {
        BN_free(e);
        BN_GENCB_free(cb);
        return rsa;
    }
 err:
    BN_free(e);
    RSA_free(rsa);
    BN_GENCB_free(cb);
    return 0;
}
</pre></div>

<p>These two functions allow us to bypass the deprecated function calls and take the work out of sorting out how to call the new types.</p>
<p>So in the file &lsquo;src/util/hitgen.c&rsquo; we copy and pasted these functions (appending a &ldquo;my_&rdquo; to the beginning of them) near the top of the file and called them instead.</p>
<p>This removed the errors during the make and we continued.</p>
<p>Here is the full changes parsed out here:</p>
<div class="codehilite"><pre>DSA *my_DSA_generate_parameters(int bits,
                             unsigned char *seed_in, int seed_len,
                             int *counter_ret, unsigned long *h_ret,
                             void (*callback) (int, int, void *),
                             void *cb_arg)
{
    ...
}

RSA *my_RSA_generate_key(int bits, unsigned long e_value,
                      void (*callback) (int, int, void *), void *cb_arg)
{
    ...
}

dsa = my_DSA_generate_parameters(opts-&gt;bitsize, seed, sizeof(seed),
                              NULL, NULL, cb, stdout);

rsa = my_RSA_generate_key(opts-&gt;bitsize, e, cb, stdout);
</pre></div>

<h3 id="errors-2-4">Errors 2 - 4<a class="headerlink" href="#errors-2-4" title="Permanent link"></a></h3>
<p><strong>FILE AFFECTED: src/util/hitgen.c</strong></p>
<div class="codehilite"><pre>util/hitgen.c: In function ‘generate_HI’:
util/hitgen.c:162:60: error: passing argument 3 of ‘RSA_generate_key_ex’ makes pointer from integer without a cast [-Werror=int-conversion]
       int retRSA = RSA_generate_key_ex(rsa, opts-&gt;bitsize, e, NULL);
                                                            ^
In file included from util/hitgen.c:40:0:
/usr/include/openssl/rsa.h:198:5: note: expected ‘BIGNUM * {aka struct bignum_st *}’ but argument is of type ‘long unsigned int’
 int RSA_generate_key_ex(RSA *rsa, int bits, BIGNUM *e, BN_GENCB *cb);
     ^~~~~~~~~~~~~~~~~~~
util/hitgen.c:140:11: error: unused variable ‘dsaRet’ [-Werror=unused-variable]
       int dsaRet = DSA_generate_parameters_ex(dsa, opts-&gt;bitsize, seed, sizeof(seed),
           ^~~~~~
util/hitgen.c:220:65: error: dereferencing pointer to incomplete type ‘DSA {aka struct dsa_st}’
       xmlNewChild(hi, NULL, BAD_CAST &quot;P&quot;, BAD_CAST BN_bn2hex(dsa-&gt;p));
                                                                 ^~
util/hitgen.c:229:65: error: dereferencing pointer to incomplete type ‘RSA {aka struct rsa_st}’
       xmlNewChild(hi, NULL, BAD_CAST &quot;N&quot;, BAD_CAST BN_bn2hex(rsa-&gt;n));
                                                                 ^~
</pre></div>

<p>We will break this error up into two parts.</p>
<h4 id="part-1">Part 1<a class="headerlink" href="#part-1" title="Permanent link"></a></h4>
<div class="codehilite"><pre>util/hitgen.c:162:60: error: passing argument 3 of ‘RSA_generate_key_ex’ makes pointer from integer without a cast [-Werror=int-conversion]
       int retRSA = RSA_generate_key_ex(rsa, opts-&gt;bitsize, e, NULL);
                                                            ^
In file included from util/hitgen.c:40:0:
/usr/include/openssl/rsa.h:198:5: note: expected ‘BIGNUM * {aka struct bignum_st *}’ but argument is of type ‘long unsigned int’
 int RSA_generate_key_ex(RSA *rsa, int bits, BIGNUM *e, BN_GENCB *cb);
     ^~~~~~~~~~~~~~~~~~~
util/hitgen.c:140:11: error: unused variable ‘dsaRet’ [-Werror=unused-variable]
 int dsaRet = DSA_generate_parameters_ex(dsa, opts-&gt;bitsize, seed, sizeof(seed),
     ^~~~~~
</pre></div>

<p>This is left over from when we were playing with attempting to code in the new way of calling the functions definitions by hand before Jim found the solution in Error 3. Should be safe to ignore this bit (you probably won&rsquo;t get this error).</p>
<h4 id="part-2">Part 2<a class="headerlink" href="#part-2" title="Permanent link"></a></h4>
<div class="codehilite"><pre>util/hitgen.c:220:65: error: dereferencing pointer to incomplete type ‘DSA {aka struct dsa_st}’
       xmlNewChild(hi, NULL, BAD_CAST &quot;P&quot;, BAD_CAST BN_bn2hex(dsa-&gt;p));
                                                                 ^~
util/hitgen.c:229:65: error: dereferencing pointer to incomplete type ‘RSA {aka struct rsa_st}’
       xmlNewChild(hi, NULL, BAD_CAST &quot;N&quot;, BAD_CAST BN_bn2hex(rsa-&gt;n));
</pre></div>

<p>These lines pointed to a larger issue that persists over the whole OpenHIP source code.</p>
<p>In the past OpenSSL&rsquo;s structs RSA, DSA, DH and others were opaque in nature. That is we could easily access the member elements through the &ldquo;-&gt;&rdquo; notation. However starting in OpenSSL 1.1.X this was no longer allowed and a new style appeared. This style consists of setter and getter functions for the various structures in OpenSSL.</p>
<p>The errors above are complaining about how the &ldquo;-&gt;&rdquo; operation is no longer a valid way to access the elements.</p>
<p>Instead the following kind of operation has to be done instead:</p>
<div class="codehilite"><pre>const BIGNUM *dsa_p, *dsa_q, *dsa_g, *dsa_pub_key, *dsa_priv_key;
DSA_get0_pqg(dsa, &amp;dsa_p, &amp;dsa_q, &amp;dsa_g);
xmlNewChild(hi, NULL, BAD_CAST &quot;P&quot;, BAD_CAST BN_bn2hex(dsa_p));
xmlNewChild(hi, NULL, BAD_CAST &quot;Q&quot;, BAD_CAST BN_bn2hex(dsa_q));
xmlNewChild(hi, NULL, BAD_CAST &quot;G&quot;, BAD_CAST BN_bn2hex(dsa_g));
</pre></div>

<p>The new getter and setter functions for DSA is defined as follows:</p>
<div class="codehilite"><pre>void DSA_get0_pqg(const DSA *d, const BIGNUM **p, const BIGNUM **q, const BIGNUM **g);
int DSA_set0_pqg(DSA *d, BIGNUM *p, BIGNUM *q, BIGNUM *g);
void DSA_get0_key(const DSA *d, const BIGNUM **pub_key, const BIGNUM **priv_key);
int DSA_set0_key(DSA *d, BIGNUM *pub_key, BIGNUM *priv_key);
</pre></div>

<p>To use this function we must pass in the DSA we are accessing. The other three arguments are passing in a variable by reference to fill them with the required value. If the function finds the value to be NULL then it ignores the argument and will not pass the value back.</p>
<p>RSA has a similar functions defined as follows:</p>
<div class="codehilite"><pre>int RSA_set0_key(RSA *r, BIGNUM *n, BIGNUM *e, BIGNUM *d);
int RSA_set0_factors(RSA *r, BIGNUM *p, BIGNUM *q);
int RSA_set0_crt_params(RSA *r,BIGNUM *dmp1, BIGNUM *dmq1, BIGNUM *iqmp);
void RSA_get0_key(const RSA *r, const BIGNUM **n, const BIGNUM **e, const BIGNUM **d);
void RSA_get0_factors(const RSA *r, const BIGNUM **p, const BIGNUM **q);
void RSA_get0_crt_params(const RSA *r, const BIGNUM **dmp1, const BIGNUM **dmq1, const BIGNUM **iqmp);
</pre></div>

<p>As you can see this follows a very similar pattern.</p>
<p>Note how the &ldquo;sets&rdquo; don&rsquo;t require a &ldquo;const&rdquo; but &ldquo;gets&rdquo; do. We will see an example of &ldquo;set&rdquo; later.</p>
<p>Below is the block with changes made to it:</p>
<div class="codehilite"><pre>const BIGNUM *dsa_p, *dsa_q, *dsa_g, *dsa_pub_key, *dsa_priv_key;
const BIGNUM *rsa_n, *rsa_e, *rsa_d, *rsa_p, *rsa_q, *rsa_dmp1, *rsa_dmq1, *rsa_iqmp;
switch (opts-&gt;type)
{
case HI_ALG_DSA:
  DSA_get0_pqg(dsa, &amp;dsa_p, &amp;dsa_q, &amp;dsa_g);
  xmlNewChild(hi, NULL, BAD_CAST &quot;P&quot;, BAD_CAST BN_bn2hex(dsa_p));
  xmlNewChild(hi, NULL, BAD_CAST &quot;Q&quot;, BAD_CAST BN_bn2hex(dsa_q));
  xmlNewChild(hi, NULL, BAD_CAST &quot;G&quot;, BAD_CAST BN_bn2hex(dsa_g));
  DSA_get0_key(dsa, &amp;dsa_pub_key, &amp;dsa_priv_key);
  xmlNewChild(hi, NULL, BAD_CAST &quot;PUB&quot;,
              BAD_CAST BN_bn2hex(dsa_pub_key));
  xmlNewChild(hi, NULL,BAD_CAST &quot;PRIV&quot;,
              BAD_CAST BN_bn2hex(dsa_priv_key));
  break;
case HI_ALG_RSA:
  RSA_get0_key(rsa, &amp;rsa_n, &amp;rsa_e, &amp;rsa_d);
  xmlNewChild(hi, NULL, BAD_CAST &quot;N&quot;, BAD_CAST BN_bn2hex(rsa_n));
  xmlNewChild(hi, NULL, BAD_CAST &quot;E&quot;, BAD_CAST BN_bn2hex(rsa_e));
  xmlNewChild(hi, NULL, BAD_CAST &quot;D&quot;, BAD_CAST BN_bn2hex(rsa_d));
  RSA_get0_factors(rsa, &amp;rsa_p, &amp;rsa_q);
  xmlNewChild(hi, NULL, BAD_CAST &quot;P&quot;, BAD_CAST BN_bn2hex(rsa_p));
  xmlNewChild(hi, NULL, BAD_CAST &quot;Q&quot;, BAD_CAST BN_bn2hex(rsa_q));
  RSA_get0_crt_params(rsa, &amp;rsa_dmp1, &amp;rsa_dmq1, &amp;rsa_iqmp);
  xmlNewChild(hi, NULL, BAD_CAST &quot;dmp1&quot;,
              BAD_CAST BN_bn2hex(rsa_dmp1));
  xmlNewChild(hi, NULL, BAD_CAST &quot;dmq1&quot;,
              BAD_CAST BN_bn2hex(rsa_dmq1));
  xmlNewChild(hi, NULL, BAD_CAST &quot;iqmp&quot;,
              BAD_CAST BN_bn2hex(rsa_iqmp));
  break;
</pre></div>

<h3 id="error-5">Error 5<a class="headerlink" href="#error-5" title="Permanent link"></a></h3>
<p><strong>FILE AFFECTED: src/util/hip_util.c</strong></p>
<div class="codehilite"><pre>util/hip_util.c: In function ‘key_data_to_hi’:
util/hip_util.c:532:14: error: dereferencing pointer to incomplete type ‘DSA {aka struct dsa_st}’
       hi-&gt;dsa-&gt;q = BN_bin2bn(&amp;data[offset], DSA_PRIV, 0);
              ^~
util/hip_util.c:549:14: error: dereferencing pointer to incomplete type ‘RSA {aka struct rsa_st}’
       hi-&gt;rsa-&gt;e = BN_bin2bn(&amp;data[offset], e_len, 0);
              ^~
util/hip_util.c: In function ‘init_crypto’:
util/hip_util.c:3158:3: error: implicit declaration of function ‘CRYPTO_malloc_init’; did you mean ‘CRYPTO_malloc’? [-Werror=implicit-function-declaration]
   CRYPTO_malloc_init();
   ^~~~~~~~~~~~~~~~~~
   CRYPTO_malloc
</pre></div>

<p>We will approach this in parts again.
All changes here are done in &lsquo;src/util/hip_util.c&rsquo;.</p>
<h4 id="part-1_1">Part 1<a class="headerlink" href="#part-1_1" title="Permanent link"></a></h4>
<div class="codehilite"><pre>util/hip_util.c:532:14: error: dereferencing pointer to incomplete type ‘DSA {aka struct dsa_st}’
       hi-&gt;dsa-&gt;q = BN_bin2bn(&amp;data[offset], DSA_PRIV, 0);
              ^~
util/hip_util.c:549:14: error: dereferencing pointer to incomplete type ‘RSA {aka struct rsa_st}’
       hi-&gt;rsa-&gt;e = BN_bin2bn(&amp;data[offset], e_len, 0);
              ^~
</pre></div>

<p>This is the exact issue we had with Errors 2 - 4, Part 2 above. We can no longer reference RSA and DSA struct parameters with the &ldquo;-&gt;&rdquo; syntax.</p>
<p>Here is the blocks with the changes made:</p>
<div class="codehilite"><pre>BIGNUM *dsa_p, *dsa_q, *dsa_g, *dsa_pub_key;
BIGNUM *rsa_n, *rsa_e;
/* read algorithm-specific key data */
switch (alg)
  {
  case HI_ALG_DSA:
    hi-&gt;dsa = DSA_new();
    /* get Q, P, G, and Y */
    offset = 1;
    dsa_q = BN_bin2bn(&amp;data[offset], DSA_PRIV, 0);
    offset += DSA_PRIV;
    dsa_p = BN_bin2bn(&amp;data[offset], key_len, 0);
    offset += key_len;
    dsa_g = BN_bin2bn(&amp;data[offset], key_len, 0);
    offset += key_len;
    DSA_set0_pqg(hi-&gt;dsa, dsa_p, dsa_q, dsa_g);
    dsa_pub_key = BN_bin2bn(&amp;data[offset], key_len, 0);
    DSA_set0_key(hi-&gt;dsa, dsa_pub_key, NULL);
#ifndef HIP_VPLS
    log_(NORM, &quot;Found DSA HI with public key: 0x&quot;);
    print_hex((char *)&amp;data[offset], key_len);
    log_(NORM, &quot;\n&quot;);
#endif
    offset += key_len;
    break;
  case HI_ALG_RSA:
    hi-&gt;rsa = RSA_new();
    offset = ((e_len &gt; 255) ? 3 : 1);
    rsa_e = BN_bin2bn(&amp;data[offset], e_len, 0);
    offset += e_len;
    rsa_n = BN_bin2bn(&amp;data[offset], key_len, 0);
#ifndef HIP_VPLS
    log_(NORM, &quot;Found RSA HI with public modulus: 0x&quot;);
    print_hex((char *)&amp;data[offset], key_len);
    log_(NORM, &quot;\n&quot;);
#endif
    offset += key_len;
    RSA_set0_key(hi-&gt;rsa, rsa_n, rsa_e, NULL);
    break;
</pre></div>

<p>Notice how the above block uses &ldquo;set0&rdquo; instead of &ldquo;get0&rdquo; and the changes made to the various variable types and how the parameters are passed.</p>
<div class="codehilite"><pre>const BIGNUM *dsa_p, *dsa_q, *dsa_g, *dsa_pub_key;
const BIGNUM *rsa_n, *rsa_e;

switch (hi-&gt;algorithm_id)
  {
  case HI_ALG_DSA:     /* RFC 2536 */
    /* Encode T, Q, P, G, Y */
    location = 0;
    out[location] = (hi-&gt;size - 64) / 8;
    location++;
    DSA_get0_pqg(hi-&gt;dsa, &amp;dsa_p, &amp;dsa_q, &amp;dsa_g);
    DSA_get0_key(hi-&gt;dsa, &amp;dsa_pub_key, NULL);
    bn2bin_safe(dsa_q, &amp;out[location], DSA_PRIV);
    bn2bin_safe(dsa_p, &amp;out[location + DSA_PRIV], hi-&gt;size);
    bn2bin_safe(dsa_g, &amp;out[location + DSA_PRIV + hi-&gt;size],
                hi-&gt;size);
    bn2bin_safe(dsa_pub_key,
                &amp;out[location + DSA_PRIV + (2 * hi-&gt;size)],
                hi-&gt;size);
    break;
  case HI_ALG_RSA:     /* RFC 3110 */
    /* Encode e_len, exponent(e), modulus(n) */
    location = 0;
    RSA_get0_key(hi-&gt;rsa, &amp;rsa_n, &amp;rsa_e, NULL);
    e_len = BN_num_bytes(rsa_e);
    if (e_len &gt; 255)
      {
        __u16 *p =  (__u16*) &amp;out[location + 1];
        out[location] = 0x0;
        *p = htons(e_len);
        location += 3;
      }
    else
      {
        out[location] = (__u8) e_len;
        location++;
      }
    location += bn2bin_safe(rsa_e, &amp;out[location], e_len);
    location += bn2bin_safe(rsa_n, &amp;out[location],
                            RSA_size(hi-&gt;rsa));
    break;
</pre></div>

<div class="codehilite"><pre>const BIGNUM *rsa_e;
/* calculate lengths and validate HIs */
switch (hi-&gt;algorithm_id)
  {
  case HI_ALG_DSA:     /* RFC 2536 */
    ...
  case HI_ALG_RSA:     /* RFC 3110 */
    if (!hi-&gt;rsa)
      {
        log_(WARN, &quot;hi_to_hit(): NULL rsa\n&quot;);
        return(-1);
      }
    len = sizeof(khi_context_id);
    RSA_get0_key(hi-&gt;rsa, NULL, &amp;rsa_e, NULL);
    len += BN_num_bytes(rsa_e) + RSA_size(hi-&gt;rsa);
    if (BN_num_bytes(rsa_e) &gt; 255)
      {
        len += 3;
      }
    else
      {
        len++;
      }
    break;
</pre></div>

<h4 id="part-2_1">Part 2<a class="headerlink" href="#part-2_1" title="Permanent link"></a></h4>
<div class="codehilite"><pre>util/hip_util.c: In function ‘init_crypto’:
util/hip_util.c:3158:3: error: implicit declaration of function ‘CRYPTO_malloc_init’; did you mean ‘CRYPTO_malloc’? [-Werror=implicit-function-declaration]
   CRYPTO_malloc_init();
   ^~~~~~~~~~~~~~~~~~
   CRYPTO_malloc
</pre></div>

<p>For this we simply commented out the call.</p>
<p>It is unknown if this important, however switching it to the compiler suggested &ldquo;CRYPTO_malloc&rdquo; requires parameters we do not understand.</p>
<h3 id="error-6">Error 6<a class="headerlink" href="#error-6" title="Permanent link"></a></h3>
<p><strong>FILE AFFECTED: include/hip/hip_sadb.h</strong></p>
<div class="codehilite"><pre>In file included from linux/hip_linux_umh.c:65:0:
./include/hip/hip_sadb.h:128:3: error: unknown type name ‘des_key_schedule’
   des_key_schedule ks[3];               /* 3-DES keys */
   ^~~~~~~~~~~~~~~~
</pre></div>

<p>Here we have another change is OpenSSL. Here it is merely a naming convention of using &ldquo;DES&rdquo; instead if &ldquo;des&rdquo;.</p>
<h3 id="error-7">Error 7<a class="headerlink" href="#error-7" title="Permanent link"></a></h3>
<p><strong>FILE AFFECTED: src/protocol/hip_cache.c</strong></p>
<div class="codehilite"><pre>protocol/hip_cache.c: In function ‘new_dh_cache_entry’:
protocol/hip_cache.c:415:7: error: dereferencing pointer to incomplete type ‘DH {aka struct dh_st}’
     dh-&gt;g = BN_new();
       ^~
</pre></div>

<p>Another example of the same error type as Errors 2 - 4, Part 2.</p>
<p>Below is the changes made:</p>
<div class="codehilite"><pre>if(ec_curve_nid[group_id]) { // check if eliptic curve diffie-hellman
  ...
}
else
{
  DH *dh = DH_new();
  BIGNUM *dh_p, *dh_g;
  dh_g = BN_new();
  dh_p = BN_new();
  /* Put prime corresponding to group_id into dh-&gt;p */
  BN_bin2bn(dhprime[group_id],
            dhprime_len[group_id], dh_p);
  /* Put generator corresponding to group_id into dh-&gt;g */
  BN_set_word(dh_g, dhgen[group_id]);
  /* By not setting dh-&gt;priv_key, allow crypto lib to pick at random */
  DH_set0_pqg(dh, dh_p, NULL, dh_g);
  if ((err = DH_generate_key(dh)) != 1)
  {
    log_(ERR, &quot;DH key generation failed %d.\n&quot;, group_id);
    log_(NORMT, &quot;DH key generation failed.\n&quot;);
    exit(1);
  }

  EVP_PKEY_assign_DH(entry-&gt;evp_dh, dh);
}
</pre></div>

<h3 id="error-8">Error 8<a class="headerlink" href="#error-8" title="Permanent link"></a></h3>
<p><strong>FILE AFFECTED: src/protocol/hip_dht.c</strong></p>
<div class="codehilite"><pre>protocol/hip_dht.c: In function ‘hip_xmlrpc_parse_response’:
protocol/hip_dht.c:1332:18: error: storage size of ‘ctx’ isn’t known
   EVP_ENCODE_CTX ctx;
                  ^~~
protocol/hip_dht.c:1332:18: error: unused variable ‘ctx’ [-Werror=unused-variable]
</pre></div>

<p>This error is pointing to how the variable &ldquo;ctx&rdquo; is initialized.</p>
<p>We must now perform an action such as the following:</p>
<div class="codehilite"><pre>EVP_ENCODE_CTX *ctx;
ctx = EVP_ENCODE_CTX_new();
if (!ctx)
{
  printf(&quot;Failed to init CTX!\n&quot;);
}
</pre></div>

<p>We could get fancier to handle the failure, but this at least allows the error to be removed.</p>
<p>Another area that will need changing because of this is below. You will have to dereference &ldquo;ctx&rdquo; by removing the &ldquo;&amp;&rdquo; in the shown locations.</p>
<div class="codehilite"><pre>/* step through array of responses */
for (node = node-&gt;children; node; node = node-&gt;next)
{
  ...
  EVP_DecodeInit(ctx);
  retval = EVP_DecodeUpdate(ctx, (__u8 *)value, &amp;i,
                            (__u8 *)data,
                            strlen((char *)data));
  ...
  EVP_DecodeFinal(ctx, data, &amp;i);
  ...
}
</pre></div>

<h3 id="error-9-10">Error 9-10<a class="headerlink" href="#error-9-10" title="Permanent link"></a></h3>
<p><strong>FILE AFFECTED: src/protocol/hip_input.c</strong></p>
<div class="codehilite"><pre>protocol/hip_input.c: In function ‘validate_signature’:
protocol/hip_input.c:3788:11: error: storage size of ‘dsa_sig’ isn’t known
   DSA_SIG dsa_sig;
           ^~~~~~~
protocol/hip_input.c:3789:13: error: storage size of ‘ecdsa_sig’ isn’t known
   ECDSA_SIG ecdsa_sig;
             ^~~~~~~~~
protocol/hip_input.c:3789:13: error: unused variable ‘ecdsa_sig’ [-Werror=unused-variable]
protocol/hip_input.c:3788:11: error: unused variable ‘dsa_sig’ [-Werror=unused-variable]
   DSA_SIG dsa_sig;
           ^~~~~~~
protocol/hip_input.c: In function ‘handle_dh’:
protocol/hip_input.c:4224:51: error: dereferencing pointer to incomplete type ‘EVP_PKEY {aka struct evp_pkey_st}’
     log_(NORM, &quot;EVP_PKEY type: %d&quot;, hip_a-&gt;peer_dh-&gt;type);
                                                   ^~
</pre></div>

<h4 id="part-1_2">Part 1<a class="headerlink" href="#part-1_2" title="Permanent link"></a></h4>
<p><div class="codehilite"><pre>protocol/hip_input.c: In function ‘validate_signature’:
protocol/hip_input.c:3788:11: error: storage size of ‘dsa_sig’ isn’t known
   DSA_SIG dsa_sig;
           ^~~~~~~
protocol/hip_input.c:3789:13: error: storage size of ‘ecdsa_sig’ isn’t known
   ECDSA_SIG ecdsa_sig;
             ^~~~~~~~~
protocol/hip_input.c:3789:13: error: unused variable ‘ecdsa_sig’ [-Werror=unused-variable]
protocol/hip_input.c:3788:11: error: unused variable ‘dsa_sig’ [-Werror=unused-variable]
   DSA_SIG dsa_sig;
           ^~~~~~~
</pre></div>
This is just like Error 8 above.</p>
<p>Below is the blcoks of changes:</p>
<div class="codehilite"><pre>DSA_SIG *dsa_sig;
dsa_sig = DSA_SIG_new();
if (!dsa_sig)
{
  printf(&quot;DSA SIG not allocated!\n&quot;);
}
ECDSA_SIG *ecdsa_sig;
ecdsa_sig = ECDSA_SIG_new();
if (!ecdsa_sig)
{
  printf(&quot;ECDSA SIG not allocated!\n&quot;);
}
</pre></div>

<div class="codehilite"><pre>BIGNUM *dsa_sig_r, *dsa_sig_s;
BIGNUM *ecdsa_sig_r, *ecdsa_sig_s;
switch (alg)
  {
  case HI_ALG_DSA:
    /* build the DSA structure */
    dsa_sig_r = BN_bin2bn(&amp;sig-&gt;signature[1], 20, NULL);
    dsa_sig_s = BN_bin2bn(&amp;sig-&gt;signature[21], 20, NULL);
    DSA_SIG_set0(dsa_sig, dsa_sig_r, dsa_sig_s);
    /* verify the DSA signature */
    err = DSA_do_verify(md, SHA256_DIGEST_LENGTH, dsa_sig, dsa);
    BN_free(dsa_sig_r);
    BN_free(dsa_sig_s);
    break;
  case HI_ALG_RSA:
    /* verify the RSA signature */
    err = RSA_verify(NID_sha1, md, SHA256_DIGEST_LENGTH,
                     sig-&gt;signature, sig_len, rsa);
    break;
  case HI_ALG_ECDSA:
    {
      int curve_name = ECDSA_get_curve_id(ecdsa);
      if (curve_name == -1) {
        log_(WARN, &quot;Curve not implemented.\n&quot;);
        return -1;
      }
      int curve_param_size = ECDSA_curve_PARAM_SIZE[curve_name];
      ecdsa_sig_r = BN_bin2bn(&amp;sig-&gt;signature[0], curve_param_size, NULL);
      ecdsa_sig_s = BN_bin2bn(&amp;sig-&gt;signature[curve_param_size], curve_param_size, NULL);
      ECDSA_SIG_set0(ecdsa_sig, ecdsa_sig_r, ecdsa_sig_s);
      err = ECDSA_do_verify(md, curve_param_size, ecdsa_sig, ecdsa);
      BN_free(ecdsa_sig_r);
      BN_free(ecdsa_sig_s);
    }
    break;
  default:
    err = -1;
    break;
  }
</pre></div>

<h4 id="part-2_2">Part 2<a class="headerlink" href="#part-2_2" title="Permanent link"></a></h4>
<p><div class="codehilite"><pre>protocol/hip_input.c: In function ‘handle_dh’:
protocol/hip_input.c:4224:51: error: dereferencing pointer to incomplete type ‘EVP_PKEY {aka struct evp_pkey_st}’
     log_(NORM, &quot;EVP_PKEY type: %d&quot;, hip_a-&gt;peer_dh-&gt;type);
                                                   ^~
</pre></div>
For this error we commented out the line as it seems to be a log function and not needed.</p>
<h3 id="error-11">Error 11<a class="headerlink" href="#error-11" title="Permanent link"></a></h3>
<p><strong>FILE AFFECTED: src/protocol/hip_output.c</strong></p>
<p><div class="codehilite"><pre>In file included from protocol/hip_output.c:42:0:
protocol/hip_output.c: In function ‘build_tlv_hostid_len’:
protocol/hip_output.c:2099:62: error: dereferencing pointer to incomplete type ‘RSA {aka struct rsa_st}’
       hi_len = sizeof(tlv_host_id) + 1 + BN_num_bytes(hi-&gt;rsa-&gt;e)
                                                              ^
protocol/hip_output.c: In function ‘build_tlv_hostid’:
protocol/hip_output.c:2162:33: error: dereferencing pointer to incomplete type ‘DSA {aka struct dsa_st}’
       len += bn2bin_safe(hi-&gt;dsa-&gt;q, &amp;data[len], DSA_PRIV);
                                 ^~
protocol/hip_output.c: In function ‘build_tlv_signature’:
protocol/hip_output.c:2407:26: error: dereferencing pointer to incomplete type ‘DSA_SIG {aka struct DSA_SIG_st}’
       bn2bin_safe(dsa_sig-&gt;r, &amp;sig-&gt;signature[1], 20);
                          ^~
protocol/hip_output.c:2438:30: error: dereferencing pointer to incomplete type ‘ECDSA_SIG {aka struct ECDSA_SIG_st}’
         bn2bin_safe(ecdsa_sig-&gt;r, &amp;sig-&gt;signature[0], curve_param_size);
                              ^~
</pre></div>
We have once again some dereferencing pointer issues like Errors 2 - 4, Part 2.</p>
<div class="codehilite"><pre>const BIGNUM *rsa_e;
switch (hi-&gt;algorithm_id)
  {
  case HI_ALG_DSA:            /*       tlv + T + Q + P,G,Y */
    if (!hi-&gt;dsa)
      {
        log_(WARN, &quot;No DSA context when building length!\n&quot;);
        return(0);
      }
    hi_len = sizeof(tlv_host_id) + 1 + DSA_PRIV + 3 * hi-&gt;size;
    break;
  case HI_ALG_RSA:            /*       tlv + e_len,e + N */
    if (!hi-&gt;rsa)
      {
        log_(WARN, &quot;No RSA context when building length!\n&quot;);
        return(0);
      }
    RSA_get0_key(hi-&gt;rsa, NULL, &amp;rsa_e, NULL);
    hi_len = sizeof(tlv_host_id) + 1 + BN_num_bytes(rsa_e)
             + RSA_size(hi-&gt;rsa);
    if (BN_num_bytes(rsa_e) &gt; 255)
      {
        hi_len += 2;
      }
    break;
  case HI_ALG_ECDSA:          /*        tlv + curve_len + public_key_len */
    if (!hi-&gt;ecdsa)
      {
        log_(WARN, &quot;No ECDSA context when building length!\n&quot;);
        return(0);
      }
      hi_len = sizeof(tlv_host_id) + 2 + HIP_ECDSA384_SIG_SIZE; // TODO: 33 if compressed
    break;

  default:
    break;
  }
</pre></div>

<div class="codehilite"><pre>const BIGNUM *dsa_p, *dsa_q, *dsa_g, *dsa_pub_key;
const BIGNUM *rsa_n, *rsa_e;
switch (hi-&gt;algorithm_id)
  {
  case HI_ALG_DSA:     /* RDATA word: flags(16), proto(8), alg(8) */
    data[len] = (__u8) (hi-&gt;size - 64) / 8;           /* T value (1 byte) */
    len++;
    DSA_get0_pqg(hi-&gt;dsa, &amp;dsa_p, &amp;dsa_q, &amp;dsa_g);
    DSA_get0_key(hi-&gt;dsa, &amp;dsa_pub_key, NULL);
    len += bn2bin_safe(dsa_q, &amp;data[len], DSA_PRIV);
    len += bn2bin_safe(dsa_p, &amp;data[len], hi-&gt;size);
    len += bn2bin_safe(dsa_g, &amp;data[len], hi-&gt;size);
    len += bn2bin_safe(dsa_pub_key, &amp;data[len], hi-&gt;size);
    break;
  case HI_ALG_RSA:
    RSA_get0_key(hi-&gt;rsa, &amp;rsa_n, &amp;rsa_e, NULL);
    e_len = BN_num_bytes(rsa_e);
    ...
    /* public exponent */
    len += bn2bin_safe(rsa_e, &amp;data[len], e_len);
    /* public modulus */
    len += bn2bin_safe(rsa_n, &amp;data[len], RSA_size(hi-&gt;rsa));
    break;
  case HI_ALG_ECDSA:
    {
    BN_CTX * bn_ctx = BN_CTX_new();
    const EC_GROUP * ec_group = EC_KEY_get0_group(hi-&gt;ecdsa);
    const EC_POINT * ec_point = EC_KEY_get0_public_key(hi-&gt;ecdsa);
    ...
    }
  default:
    break;
  }
</pre></div>

<div class="codehilite"><pre>const BIGNUM *dsa_sig_r, *dsa_sig_s, *ecdsa_sig_r, *ecdsa_sig_s;
switch (hi-&gt;algorithm_id)
  {
  case HI_ALG_DSA:
    ...
    /* build signature from DSA_SIG struct */
    DSA_SIG_get0(dsa_sig, &amp;dsa_sig_r, &amp;dsa_sig_s);
    bn2bin_safe(dsa_sig_r, &amp;sig-&gt;signature[1], 20);
    bn2bin_safe(dsa_sig_s, &amp;sig-&gt;signature[21], 20);
    DSA_SIG_free(dsa_sig);
    break;
  case HI_ALG_RSA:
    ...
  case HI_ALG_ECDSA: /* RFC 4754 */
    {
      ...
      ECDSA_SIG_get0(ecdsa_sig, &amp;ecdsa_sig_r, &amp;ecdsa_sig_s);
      bn2bin_safe(ecdsa_sig_r, &amp;sig-&gt;signature[0], curve_param_size);
      bn2bin_safe(ecdsa_sig_s, &amp;sig-&gt;signature[curve_param_size], curve_param_size);

      ECDSA_SIG_free(ecdsa_sig);
      sig_len = 2 * curve_param_size; 
    }
    break;
  default:
    break;
  }
</pre></div>

<h3 id="error-12">Error 12<a class="headerlink" href="#error-12" title="Permanent link"></a></h3>
<p><strong>FILE AFFECTED: src/util/hip_xml.c</strong></p>
<p><div class="codehilite"><pre>util/hip_xml.c: In function ‘parse_xml_hostid’:
util/hip_xml.c:270:33: error: dereferencing pointer to incomplete type ‘DSA {aka struct dsa_st}’
               BN_hex2bn(&amp;hi-&gt;dsa-&gt;p, data);
                                 ^~
util/hip_xml.c:292:33: error: dereferencing pointer to incomplete type ‘RSA {aka struct rsa_st}’
               BN_hex2bn(&amp;hi-&gt;rsa-&gt;n, data);
                                 ^~
</pre></div>
Same thing. Note that this paticular block is reading in data from a configuration file and pushing it into our running code.
For both RSA and DSA we need to put the values in BIGNUM variables then use their respective setter to push the value into the structure in OpenSSL.
The &ldquo;&amp;hi-&gt;dsa-&gt;p&rdquo; worked before but now has to be broken up as follows:</p>
<div class="codehilite"><pre>BIGNUM *dsa_p, *dsa_q, *dsa_g, *dsa_pub_key, *dsa_priv_key;
BIGNUM *rsa_n, *rsa_e, *rsa_d, *rsa_p, *rsa_q, *rsa_dmp1, *rsa_dmq1, *rsa_iqmp;
/* populate the DSA structure */
switch (hi-&gt;algorithm_id)
  {
  case HI_ALG_DSA:
    if (strcmp((char *)node-&gt;name, &quot;P&quot;) == 0)
      {
        BN_hex2bn(&amp;dsa_p, data);
        DSA_set0_pqg(hi-&gt;dsa, dsa_p, NULL, NULL);
      }
    else if (strcmp((char *)node-&gt;name, &quot;Q&quot;) == 0)
      {
        BN_hex2bn(&amp;dsa_q, data);
        DSA_set0_pqg(hi-&gt;dsa, NULL, dsa_q, NULL);
      }
    else if (strcmp((char *)node-&gt;name, &quot;G&quot;) == 0)
      {
        BN_hex2bn(&amp;dsa_g, data);
        DSA_set0_pqg(hi-&gt;dsa, NULL, NULL, dsa_g);
      }
    else if (strcmp((char *)node-&gt;name, &quot;PUB&quot;) == 0)
      {
        BN_hex2bn(&amp;dsa_pub_key, data);
        DSA_set0_key(hi-&gt;dsa, dsa_pub_key, NULL);
      }
    else if (strcmp((char *)node-&gt;name, &quot;PRIV&quot;) == 0)
      {
        BN_hex2bn(&amp;dsa_priv_key, data);
        DSA_set0_key(hi-&gt;dsa, NULL, dsa_priv_key);
      }
    break;
  case HI_ALG_RSA:
    if (strcmp((char *)node-&gt;name, &quot;N&quot;) == 0)
      {
        BN_hex2bn(&amp;rsa_n, data);
        RSA_set0_key(hi-&gt;rsa, rsa_n, NULL, NULL);
      }
    else if (strcmp((char *)node-&gt;name, &quot;E&quot;) == 0)
      {
        BN_hex2bn(&amp;rsa_e, data);
        RSA_set0_key(hi-&gt;rsa, NULL, rsa_e, NULL);
      }
    else if (strcmp((char *)node-&gt;name, &quot;D&quot;) == 0)
      {
        BN_hex2bn(&amp;rsa_d, data);
        RSA_set0_key(hi-&gt;rsa, NULL, NULL, rsa_d);
      }
    else if (strcmp((char *)node-&gt;name, &quot;P&quot;) == 0)
      {
        BN_hex2bn(&amp;rsa_p, data);
        RSA_set0_factors(hi-&gt;rsa, rsa_p, NULL);
      }
    else if (strcmp((char *)node-&gt;name, &quot;Q&quot;) == 0)
      {
        BN_hex2bn(&amp;rsa_q, data);
        RSA_set0_factors(hi-&gt;rsa, NULL, rsa_q);
      }
    else if (strcmp((char *)node-&gt;name, &quot;dmp1&quot;) == 0)
      {
        BN_hex2bn(&amp;rsa_dmp1, data);
        RSA_set0_crt_params(hi-&gt;rsa, rsa_dmp1, NULL, NULL);
      }
    else if (strcmp((char *)node-&gt;name, &quot;dmq1&quot;) == 0)
      {
        BN_hex2bn(&amp;rsa_dmq1, data);
        RSA_set0_crt_params(hi-&gt;rsa, NULL, rsa_dmq1, NULL);
      }
    else if (strcmp((char *)node-&gt;name, &quot;iqmp&quot;) == 0)
      {
        BN_hex2bn(&amp;rsa_iqmp, data);
        RSA_set0_crt_params(hi-&gt;rsa, NULL, NULL, rsa_iqmp);
      }
      break;
</pre></div>

<div class="codehilite"><pre>if (mine)
{
  const BIGNUM *dsa_p, *dsa_q, *dsa_g, *dsa_pub_key, *dsa_priv_key;
  const BIGNUM *rsa_n, *rsa_e, *rsa_d, *rsa_p, *rsa_q, *rsa_dmp1, *rsa_dmq1, *rsa_iqmp;
  switch (h-&gt;algorithm_id)
    {
    case HI_ALG_DSA:
      DSA_get0_pqg(h-&gt;dsa, &amp;dsa_p, &amp;dsa_q, &amp;dsa_g);
      DSA_get0_key(h-&gt;dsa, &amp;dsa_pub_key, &amp;dsa_priv_key);
      xmlNewChild_from_bn(hi, dsa_p, &quot;P&quot;);
      xmlNewChild_from_bn(hi, dsa_q, &quot;Q&quot;);
      xmlNewChild_from_bn(hi, dsa_g, &quot;G&quot;);
      xmlNewChild_from_bn(hi, dsa_pub_key, &quot;PUB&quot;);
      xmlNewChild_from_bn(hi, dsa_priv_key, &quot;PRIV&quot;);
      break;
    case HI_ALG_RSA:
      RSA_get0_key(h-&gt;rsa, &amp;rsa_n, &amp;rsa_e, &amp;rsa_d);
      RSA_get0_factors(h-&gt;rsa, &amp;rsa_p, &amp;rsa_q);
      RSA_get0_crt_params(h-&gt;rsa, &amp;rsa_dmp1, &amp;rsa_dmq1, &amp;rsa_iqmp);
      xmlNewChild_from_bn(hi, rsa_n, &quot;N&quot;);
      xmlNewChild_from_bn(hi, rsa_e, &quot;E&quot;);
      xmlNewChild_from_bn(hi, rsa_d, &quot;D&quot;);
      xmlNewChild_from_bn(hi, rsa_p, &quot;P&quot;);
      xmlNewChild_from_bn(hi, rsa_q, &quot;Q&quot;);
      xmlNewChild_from_bn(hi, rsa_dmp1, &quot;dmp1&quot;);
      xmlNewChild_from_bn(hi, rsa_dmq1, &quot;dmq1&quot;);
      xmlNewChild_from_bn(hi, rsa_iqmp, &quot;iqmp&quot;);
</pre></div>

<h3 id="error-13">Error 13<a class="headerlink" href="#error-13" title="Permanent link"></a></h3>
<p><strong>FILE AFFECTED: src/usermode/hip_esp.c</strong></p>
<div class="codehilite"><pre>usermode/hip_esp.c: In function ‘hip_esp_encrypt’:
usermode/hip_esp.c:2074:7: error: implicit declaration of function ‘des_ede3_cbc_encrypt’; did you mean ‘DES_ede3_cbc_encrypt’? [-Werror=implicit-function-declaration]
       des_ede3_cbc_encrypt(&amp;in[hdr_len],
       ^~~~~~~~~~~~~~~~~~~~
       DES_ede3_cbc_encrypt
usermode/hip_esp.c:2077:29: error: ‘des_cblock’ undeclared (first use in this function); did you mean ‘DES_cblock’?
                            (des_cblock*)cbc_iv, DES_ENCRYPT);
                             ^~~~~~~~~~
                             DES_cblock
usermode/hip_esp.c:2077:29: note: each undeclared identifier is reported only once for each function it appears in
usermode/hip_esp.c:2077:40: error: expected expression before ‘)’ token
                            (des_cblock*)cbc_iv, DES_ENCRYPT);
                                        ^
usermode/hip_esp.c: In function ‘hip_esp_decrypt’:
usermode/hip_esp.c:2474:29: error: ‘des_cblock’ undeclared (first use in this function); did you mean ‘DES_cblock’?
                            (des_cblock*)cbc_iv, DES_DECRYPT);
                             ^~~~~~~~~~
                             DES_cblock
usermode/hip_esp.c:2474:40: error: expected expression before ‘)’ token
                            (des_cblock*)cbc_iv, DES_DECRYPT);
                                        ^
</pre></div>

<p>These errors are related to Error 6.</p>
<p>We change the &ldquo;des&rdquo; to be &ldquo;DES&rdquo; to fix the warnings.</p>
<h3 id="error-14">Error 14<a class="headerlink" href="#error-14" title="Permanent link"></a></h3>
<p><strong>FILE AFFECTED: src/usermode/hip_esp.c</strong></p>
<div class="codehilite"><pre>usermode/hip_esp.c: In function ‘hip_esp_encrypt’:
usermode/hip_esp.c:2076:28: error: incompatible type for argument 4 of ‘DES_ede3_cbc_encrypt’
                            entry-&gt;ks[0], entry-&gt;ks[1], entry-&gt;ks[2],
                            ^~~~~
In file included from usermode/hip_esp.c:63:0:
/usr/include/openssl/des.h:119:6: note: expected ‘DES_key_schedule * {aka struct DES_ks *}’ but argument is of type ‘DES_key_schedule {aka struct DES_ks}’
 void DES_ede3_cbc_encrypt(const unsigned char *input, unsigned char *output,
      ^~~~~~~~~~~~~~~~~~~~
usermode/hip_esp.c:2076:42: error: incompatible type for argument 5 of ‘DES_ede3_cbc_encrypt’
                            entry-&gt;ks[0], entry-&gt;ks[1], entry-&gt;ks[2],
                                          ^~~~~
In file included from usermode/hip_esp.c:63:0:
/usr/include/openssl/des.h:119:6: note: expected ‘DES_key_schedule * {aka struct DES_ks *}’ but argument is of type ‘DES_key_schedule {aka struct DES_ks}’
 void DES_ede3_cbc_encrypt(const unsigned char *input, unsigned char *output,
      ^~~~~~~~~~~~~~~~~~~~
usermode/hip_esp.c:2076:56: error: incompatible type for argument 6 of ‘DES_ede3_cbc_encrypt’
                            entry-&gt;ks[0], entry-&gt;ks[1], entry-&gt;ks[2],
                                                        ^~~~~
In file included from usermode/hip_esp.c:63:0:
/usr/include/openssl/des.h:119:6: note: expected ‘DES_key_schedule * {aka struct DES_ks *}’ but argument is of type ‘DES_key_schedule {aka struct DES_ks}’
 void DES_ede3_cbc_encrypt(const unsigned char *input, unsigned char *output,
      ^~~~~~~~~~~~~~~~~~~~
usermode/hip_esp.c: In function ‘hip_esp_decrypt’:
usermode/hip_esp.c:2473:28: error: incompatible type for argument 4 of ‘DES_ede3_cbc_encrypt’
                            entry-&gt;ks[0], entry-&gt;ks[1], entry-&gt;ks[2],
                            ^~~~~
In file included from usermode/hip_esp.c:63:0:
/usr/include/openssl/des.h:119:6: note: expected ‘DES_key_schedule * {aka struct DES_ks *}’ but argument is of type ‘DES_key_schedule {aka struct DES_ks}’
 void DES_ede3_cbc_encrypt(const unsigned char *input, unsigned char *output,
      ^~~~~~~~~~~~~~~~~~~~
usermode/hip_esp.c:2473:42: error: incompatible type for argument 5 of ‘DES_ede3_cbc_encrypt’
                            entry-&gt;ks[0], entry-&gt;ks[1], entry-&gt;ks[2],
                                          ^~~~~
In file included from usermode/hip_esp.c:63:0:
/usr/include/openssl/des.h:119:6: note: expected ‘DES_key_schedule * {aka struct DES_ks *}’ but argument is of type ‘DES_key_schedule {aka struct DES_ks}’
 void DES_ede3_cbc_encrypt(const unsigned char *input, unsigned char *output,
      ^~~~~~~~~~~~~~~~~~~~
usermode/hip_esp.c:2473:56: error: incompatible type for argument 6 of ‘DES_ede3_cbc_encrypt’
                            entry-&gt;ks[0], entry-&gt;ks[1], entry-&gt;ks[2],
                                                        ^~~~~
In file included from usermode/hip_esp.c:63:0:
/usr/include/openssl/des.h:119:6: note: expected ‘DES_key_schedule * {aka struct DES_ks *}’ but argument is of type ‘DES_key_schedule {aka struct DES_ks}’
 void DES_ede3_cbc_encrypt(const unsigned char *input, unsigned char *output,
      ^~~~~~~~~~~~~~~~~~~~
</pre></div>

<p>This giant wall of errors is related again to Error 6.</p>
<p>The &lsquo;entry&rsquo; variable is passed into the function &lsquo;hip_esp_encrypt&rsquo; as a pointer. However to access the array &ldquo;ks&rdquo; we must reference the variable.</p>
<p>We do this by adding a &ldquo;&amp;&rdquo; before every instance of &ldquo;entry-&gt;ks[]&rdquo; being called.</p>
<h3 id="error-15">Error 15<a class="headerlink" href="#error-15" title="Permanent link"></a></h3>
<p><strong>FILE AFFECTED: src/usermode/hip_esp.c</strong></p>
<div class="codehilite"><pre>In file included from usermode/hip_esp.c:70:0:
usermode/hip_esp.c: In function ‘send_icmp’:
./include/win32/checksum.h:75:14: error: ‘*((void *)&amp;icmp_parameter_problem+26)’ is used uninitialized in this function [-Werror=uninitialized]
       sum += *p++;
              ^~~~
</pre></div>

<p>This error we could not trace or figure out. There is an inline function (in checksum.h) that is being called.
Looking at the function &ldquo;send_icmp&rdquo; in &lsquo;src/usermode/hip_esp.c&rsquo; seems to show no really issues.
By commenting out the line (243 on our build) where the inline function is called the error goes away.</p>
<p>To fix the error we changed the file &lsquo;src/Makefile&rsquo;. We took out the -Werror flag under the CFLAG definition.
We know this is not the right answer but we do not understand how it functions to actually debug.</p>
<p>NOTE: From here to the end the &ldquo;-Werror&rdquo; flag is missing.</p>
<h3 id="errors-16-17">Errors 16 - 17<a class="headerlink" href="#errors-16-17" title="Permanent link"></a></h3>
<p><strong>FILE AFFECTED: src/usermode/hip_sadb.c</strong></p>
<p><div class="codehilite"><pre>usermode/hip_sadb.c: In function ‘hip_sadb_add’:
usermode/hip_sadb.c:393:7: warning: implicit declaration of function ‘des_set_odd_parity’; did you mean ‘DES_set_odd_parity’? [-Wimplicit-function-declaration]
       des_set_odd_parity((des_cblock*)key1);
       ^~~~~~~~~~~~~~~~~~
       DES_set_odd_parity
usermode/hip_sadb.c:393:27: error: ‘des_cblock’ undeclared (first use in this function); did you mean ‘DES_cblock’?
       des_set_odd_parity((des_cblock*)key1);
                           ^~~~~~~~~~
                           DES_cblock
usermode/hip_sadb.c:393:27: note: each undeclared identifier is reported only once for each function it appears in
usermode/hip_sadb.c:393:38: error: expected expression before ‘)’ token
       des_set_odd_parity((des_cblock*)key1);
                                      ^
usermode/hip_sadb.c:394:38: error: expected expression before ‘)’ token
       des_set_odd_parity((des_cblock*)key2);
                                      ^
usermode/hip_sadb.c:395:38: error: expected expression before ‘)’ token
       des_set_odd_parity((des_cblock*)key3);
                                      ^
usermode/hip_sadb.c:396:13: warning: implicit declaration of function ‘des_set_key_checked’; did you mean ‘DES_set_key_checked’? [-Wimplicit-function-declaration]
       err = des_set_key_checked((des_cblock*)key1, entry-&gt;ks[0]);
             ^~~~~~~~~~~~~~~~~~~
             DES_set_key_checked
usermode/hip_sadb.c:396:45: error: expected expression before ‘)’ token
       err = des_set_key_checked((des_cblock*)key1, entry-&gt;ks[0]);
                                             ^
usermode/hip_sadb.c:397:46: error: expected expression before ‘)’ token
       err += des_set_key_checked((des_cblock*)key2, entry-&gt;ks[1]);
                                              ^
usermode/hip_sadb.c:398:46: error: expected expression before ‘)’ token
       err += des_set_key_checked((des_cblock*)key3, entry-&gt;ks[2]);
                                              ^
</pre></div>
This is another side effect of Error 6 and Error 7.
Change all &ldquo;des&rdquo; to &ldquo;DES&rdquo; and add &ldquo;&amp;&rdquo; before the &ldquo;entry-&gt;ks[]&rdquo; instances.</p>
<h2 id="finish-building">Finish Building<a class="headerlink" href="#finish-building" title="Permanent link"></a></h2>
<p>From here there should be no errors in the build.</p>
<p>Run the following:</p>
<div class="codehilite"><pre>sudo make install
</pre></div>

<p>This should place files in various locations in the system (mainly &lsquo;/usr/local/&rsquo;) under &lsquo;etc/&rsquo; and &lsquo;sbin/&rsquo;.</p>
<p>With that OpenHIP should be built and ready to configure.</p>
<h1 id="configure-run-openhip-broken">Configure &amp; Run OpenHIP (BROKEN)<a class="headerlink" href="#configure-run-openhip-broken" title="Permanent link"></a></h1>
<p>DISCLAIMER: This does not actually work!</p>
<div class="codehilite"><pre>cd /usr/local/sbin
sudo ./hitgen
sudo ./hitgen -conf
sudo ./hitgen -publish
sudo ./hip -v
</pre></div>

<p>This should generate our HITs, create configuration files and publish our HIT file.
The final command should fail with a segfault.</p>
<p>This is where we stopped and pursued a different path to work with OpenHIP as we did not have time nor the expertise to get OpenHIP updated to work with newer versions of OpenSSL.</p>
<h2 id="contact-final-words">Contact &amp; Final Words<a class="headerlink" href="#contact-final-words" title="Permanent link"></a></h2>
<p>The information presented here was compiled by Adam Wiethuechter and Jim Henrickson of Critical Technologies Inc. (CTI).
Everything here is free to use without restriction as these are just cleaned up notes.</p>
<p>We hope that this document and the information presented in it, along with the files packaged with it will be helpful to anyone wishing to continue to development of OpenHIP to work with newer versions of OpenSSL.</p></article></body></html>